<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tour Kalender</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
  </head>
  <body>
      <h1 class="text-center mb-4">Tour Kalender</h1>
      <div id="calendar"></div>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        
        var calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: 'timeGridWeek', // Anzeige auf eine Woche ändern
          themeSystem: 'bootstrap5',
          windowResize: true,
          hiddenDays: [0],
          businessHours: [{
            daysOfWeek: [1,2,3,4,5],
            startTime: '7:00',
            endTime: '17:00'
          },
          {
            daysOfWeek: [6],
            startTime: '8:00',
            endTime: '15:00'
          }],
          editable: true,
          eventDrop: function(info) {
            var eventID = info.event.id;
            var newDate = info.event.start;
            console.log(info.event.id)

            fetch('/update_date', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ id: eventID, newDate: newDate })
            })
            .then(response => response.json())
            .then(data => {
              console.log("Event wurde verschoben und in Datenbank aktualisiert:", data.message);
            })
            .catch(error => {
              console.error("Fehler beim Aktualisieren:", error);
            });
          },
          eventSources: [
            {
              url: '/get_tours', // Die Flask-Route zum Abrufen der Tour-Daten
              method: 'GET',
              extraParams: {
                // Wenn benötigt, können hier zusätzliche Parameter hinzugefügt werden
              },
              failure: function() {
                console.log('Fehler beim Laden der Ereignisse!');
              }
            }
          ],
          eventContent: function(arg) {
            return {
              html: '<b>' + arg.event.title + '</b>' + '<br>' + arg.event.extendedProps.description
            };
          }
        });
          calendar.render();
        });
    </script>
  </body>
</html>
